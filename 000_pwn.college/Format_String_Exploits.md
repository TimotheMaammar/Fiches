# Vidéos

Simple test pour vérifier où un printf() va chercher tous ses arguments : 

	printf("%d %d %d %d %d %d %d\n");

Puis avec GDB on inspecte les registres et la stack : 

	disass main
	b *main+115
	r
	info reg
	x/4gx $rsp

On voit que les premières valeurs sont stockées dans des registres mais que cela continue ensuite dans la stack.

Si on reste sur l'exemple de printf(), qui est la fonction la plus connue étant potentiellement vulnérable, on peut donc leaker de la donnée avec plusieurs formats :

- %c => Lire un caractère de la stack
- %d / %i / %x => Lire un nombre de la stack
- %x => Lire un nombre aussi mais en hexadécimal 
- %p => Lire un pointeur
- %s => Déréférencer un pointeur et lire des octets jusqu'à rencontrer un '\0'

Il y a également un alias `$` dans glibc qui permet de cibler directement un argument éloigné dans la stack sans avoir besoin d'afficher plein de %p avant. Par exemple pour afficher le 7ème argument il suffira d'un `%7$s` au lieu de `%p %p %p %p %p %p %s`

En plus de cette astuce avec `$` on peut aussi jouer avec le spécificateur %n qui sert à écrire dans l'argument correspondant le nombre de caractères déjà écrits par printf() jusqu'à ce point. Cela permet de réécrire des valeurs arbitraires dans des adresses données, c'est parfois assez compliqué mais quand même très puissant.

# Challenges

## babyfmt_level1.0

La consigne donne plusieurs informations utiles :

- Le mot de passe est une chaîne de 15 lettres majuscules
- Le mot de passe se trouve à l'adresse 0x7ffd9365ef40 et le pointeur de pile se trouve à l'adresse 0x7ffd9365ef10

La différence entre les adresses est de 0x30 soit 48 en décimal.
On est sur un système 64-bits donc on a un paquet de 8 octets par adresse.
Cela donne 48 / 8 = 6 positions de décalage entre le pointeur de pile et le mot de passe.

Payload à envoyer (car un %llx fait 8 octets donc cela couvre tout le mot de passe) :

```
%6$llx.%7$llx
```

Résultat renvoyé par le printf() qui suit :

```
4347505341464a55.46484c4d42514c
```

Conversion en little-endian puis en ASCII de ce résultat et on obtient le mot de passe, dont on a la longueur donnée en consigne pour aider.
